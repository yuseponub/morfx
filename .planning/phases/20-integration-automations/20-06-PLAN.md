---
phase: 20-integration-automations
plan: 06
type: execute
wave: 3
depends_on: ["20-01"]
files_modified:
  - src/app/(dashboard)/automatizaciones/components/trigger-step.tsx
  - src/app/(dashboard)/automatizaciones/components/actions-step.tsx
autonomous: true

must_haves:
  truths:
    - "Trigger step wizard shows Shopify category with purple color and ShoppingBag icon"
    - "3 Shopify triggers selectable in the wizard with correct labels and variables"
    - "Actions step wizard shows Twilio category with teal color and Phone icon"
    - "send_sms action selectable with body (textarea), to (text), mediaUrl (text) params"
    - "send_sms shows MMS warning for non-US/Canada numbers"
    - "send_sms validates Twilio is configured before allowing selection"
  artifacts:
    - path: "src/app/(dashboard)/automatizaciones/components/trigger-step.tsx"
      provides: "Shopify category in trigger selection"
      contains: "Shopify"
    - path: "src/app/(dashboard)/automatizaciones/components/actions-step.tsx"
      provides: "Twilio category in action selection with send_sms params UI"
      contains: "Twilio"
  key_links:
    - from: "src/app/(dashboard)/automatizaciones/components/trigger-step.tsx"
      to: "src/lib/automations/constants.ts"
      via: "Reads TRIGGER_CATALOG for Shopify entries"
      pattern: "TRIGGER_CATALOG"
    - from: "src/app/(dashboard)/automatizaciones/components/actions-step.tsx"
      to: "src/lib/automations/constants.ts"
      via: "Reads ACTION_CATALOG for send_sms entry"
      pattern: "ACTION_CATALOG"
---

<objective>
Wizard UI extension: Add Shopify trigger category and Twilio action category to the automation builder wizard.

Purpose: After this plan, users creating automations via the wizard can select Shopify triggers (order_created, draft_order_created, order_updated) and the send_sms Twilio action with full parameter UI including variable support. The wizard validates that Twilio is configured before allowing send_sms selection.

Output: Shopify trigger category, Twilio action category, send_sms params UI with validation.
</objective>

<execution_context>
@/home/jose147/.claude/get-shit-done/workflows/execute-plan.md
@/home/jose147/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-integration-automations/20-CONTEXT.md
@.planning/phases/20-integration-automations/20-RESEARCH.md
@src/app/(dashboard)/automatizaciones/components/trigger-step.tsx
@src/app/(dashboard)/automatizaciones/components/actions-step.tsx
@src/lib/automations/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Shopify category to trigger step wizard</name>
  <files>src/app/(dashboard)/automatizaciones/components/trigger-step.tsx</files>
  <action>
1. Read trigger-step.tsx to find the existing CATEGORY_CONFIG and CATEGORIES arrays.

2. Add Shopify to CATEGORY_CONFIG:
   ```typescript
   Shopify: { icon: ShoppingBag, color: 'text-purple-600 bg-purple-50 dark:bg-purple-950/50' },
   ```
   Import `ShoppingBag` from 'lucide-react' (alongside existing icon imports).

3. Add 'Shopify' to the CATEGORIES array:
   ```typescript
   const CATEGORIES: TriggerCategory[] = ['CRM', 'WhatsApp', 'Tareas', 'Shopify']
   ```

4. Update the TriggerCategory type (if it's a local type) to include 'Shopify':
   ```typescript
   type TriggerCategory = 'CRM' | 'WhatsApp' | 'Tareas' | 'Shopify'
   ```

5. The rest of the trigger-step UI should already work because it reads from TRIGGER_CATALOG and groups by category. The 3 Shopify triggers added to TRIGGER_CATALOG in Plan 01 will automatically appear under the "Shopify" category.

6. Verify that the variable picker (shown when a Shopify trigger is selected) correctly loads variables from VARIABLE_CATALOG for the selected trigger type. This should work automatically since VARIABLE_CATALOG was extended in Plan 01.

No changes needed to condition-step or other wizard steps -- conditions work on any trigger context.
  </action>
  <verify>`grep 'Shopify' src/app/(dashboard)/automatizaciones/components/trigger-step.tsx` -- finds the category. `grep 'ShoppingBag' src/app/(dashboard)/automatizaciones/components/trigger-step.tsx` -- icon imported.</verify>
  <done>Trigger step shows Shopify category with purple color, ShoppingBag icon, and 3 Shopify triggers from TRIGGER_CATALOG.</done>
</task>

<task type="auto">
  <name>Task 2: Add Twilio category and send_sms params to actions step wizard</name>
  <files>src/app/(dashboard)/automatizaciones/components/actions-step.tsx</files>
  <action>
1. Read actions-step.tsx to find the existing action category config and action params rendering.

2. Add Twilio to the action category config:
   ```typescript
   Twilio: { icon: Phone, color: 'text-teal-600 bg-teal-50 dark:bg-teal-950/50' },
   ```
   Import `Phone` from 'lucide-react'.

3. Add 'Twilio' to the action categories array.

4. The send_sms action from ACTION_CATALOG has 3 params:
   - `body` (textarea, required, supportsVariables) -- this should render as a textarea with variable picker ({{}}) support. The existing `ActionParamField` component handles `type: 'textarea'` with `supportsVariables: true`.
   - `to` (text, optional, supportsVariables) -- renders as text input. Help text: "Dejar vacio para usar el telefono del contacto del trigger"
   - `mediaUrl` (text, optional) -- renders as text input. Help text: "MMS solo disponible para numeros de US/Canada"

5. Add Twilio configuration validation:
   When the user selects send_sms action, check if Twilio is configured for the workspace:
   - Call a lightweight check (either a server action or check from already-loaded data)
   - If NOT configured: show a warning banner inside the action params area:
     "Twilio no configurado. Configura tus credenciales en Configuracion > Integraciones antes de usar esta accion."
   - Make the warning non-blocking (user can still save the automation, but it will fail at runtime if Twilio not configured). This matches the pattern from CONTEXT.md: "bloquear la accion con mensaje de configurar primero" -- interpret as a visible warning that blocks the action from executing, not from being saved.
   - Alternative: if checking at save time is simpler, add a validation check in the wizard's onSave that warns if send_sms is used without Twilio configured.

6. Add SMS message preview:
   Below the body textarea, show a preview of the resolved message with sample variable data. This reuses the existing variable preview pattern if one exists, or simply show the raw template with a note "Variables como {{contacto.nombre}} se resuelven al ejecutarse".

IMPORTANT: The `ActionParamField` component in actions-step.tsx dynamically renders UI controls based on param.type from ACTION_CATALOG. Since send_sms uses standard param types (textarea, text), the existing rendering should work. The main additions are:
- Twilio category entry
- MMS geography warning on mediaUrl field
- Twilio-not-configured warning
  </action>
  <verify>`grep 'Twilio' src/app/(dashboard)/automatizaciones/components/actions-step.tsx` -- finds the category. `grep 'Phone' src/app/(dashboard)/automatizaciones/components/actions-step.tsx` -- icon imported. `npx tsc --noEmit 2>&1 | grep "actions-step\|trigger-step"` -- no type errors.</verify>
  <done>Actions step shows Twilio category with teal color, Phone icon. send_sms renders body textarea with variable support, optional to field, optional mediaUrl with MMS warning. Twilio-not-configured warning shown when applicable.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit 2>&1 | grep "trigger-step\|actions-step"` -- no type errors
- `grep 'Shopify' src/app/(dashboard)/automatizaciones/components/trigger-step.tsx` -- category present
- `grep 'Twilio' src/app/(dashboard)/automatizaciones/components/actions-step.tsx` -- category present
- Navigate to /automatizaciones, click "Crear automatizacion", verify Shopify triggers visible in step 1, Twilio actions visible in step 3
</verification>

<success_criteria>
- Shopify category visible in trigger step with 3 triggers
- Twilio category visible in actions step with send_sms
- send_sms params render correctly (body textarea, to text, mediaUrl text)
- Variable picker works for body and to fields
- MMS warning displayed for mediaUrl
- Twilio-not-configured warning shown when applicable
</success_criteria>

<output>
After completion, create `.planning/phases/20-integration-automations/20-06-SUMMARY.md`
</output>
