---
phase: 15.6-sandbox-evolution
plan: 06
type: execute
wave: 3
depends_on: ["15.6-04", "15.6-05"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Multi-panel debug shows 2-3 tabs simultaneously with drag-reorder"
    - "Tools tab shows dry-run tool calls when Order Manager CRM agent is enabled"
    - "Tokens tab shows Haiku vs Sonnet breakdown"
    - "Ingest tab shows timer presets and classification timeline"
    - "CRM agent toggle works in header (enable/disable, dry-run/live)"
    - "Existing conversational flow works without CRM agents selected"
  artifacts: []
  key_links: []
---

<objective>
Human verification of all Phase 15.6 success criteria. Test the complete sandbox evolution: multi-panel debug, CRM agent separation, dry-run tools, ingest tab, and per-model tokens.

Purpose: Verify all 6 success criteria pass before marking the phase complete.
Output: Verified sandbox evolution or list of issues to fix.
</objective>

<execution_context>
@/home/jose147/.claude/get-shit-done/workflows/execute-plan.md
@/home/jose147/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restart server and prepare for verification</name>
  <files></files>
  <action>
Restart the development server:
```bash
pkill -f "next dev" 2>/dev/null; sleep 2; cd /mnt/c/Users/Usuario/Proyectos/morfx-new && npm run dev &
```

Wait for the server to start on port 3020, then verify the sandbox page loads without errors by checking the terminal output.
  </action>
  <verify>
Server starts on port 3020 without errors.
  </verify>
  <done>Server is running and accessible.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Sandbox Evolution (Phase 15.6):
1. Multi-panel debug with draggable tab bar (max 3 panels visible)
2. Tools tab with dry-run visibility (DRY/LIVE badges, mock inputs/outputs)
3. CRM agent multi-select in header with dry-run/live toggle
4. Ingest tab with timer presets (Real/Rapido/Instantaneo) and classification timeline
5. Tokens tab with per-model breakdown (Haiku vs Sonnet, input/output split)
  </what-built>
  <how-to-verify>
Visit http://localhost:3020/sandbox

**Test 1: Multi-panel debug (SC4)**
1. Verify tab bar shows 5 tabs: Tools, Estado, Intent, Tokens, Ingest
2. Default should show Tools + Estado visible (2 panels)
3. Click "Tokens" to add a third panel (should show 3 panels in grid)
4. Click "Intent" - should be disabled (max 3 already visible)
5. Click "Tools" to hide it, then click "Intent" - should work
6. Drag a tab to reorder it in the tab bar

**Test 2: CRM agents (SC3)**
1. Click "CRM Agents" button in header
2. Verify "Order Manager" appears in dropdown
3. Check the Order Manager checkbox to enable it
4. Verify dry-run/live toggle appears
5. Toggle should default to "Dry"

**Test 3: Conversational flow + Tools (SC1, SC2)**
1. Send "hola" as a message
2. Verify Somnio agent responds normally
3. If Tools tab is visible, may show no tools (conversational only)
4. Try a full flow ending in order creation:
   - Send: "hola, me interesa el tratamiento"
   - Send customer data
   - Complete flow until shouldCreateOrder
   - With Order Manager in dry-run, Tools tab should show mock tool calls with DRY badge

**Test 4: Ingest tab (SC5)**
1. Make Ingest tab visible (click it in tab bar)
2. Verify timer presets: Real, Rapido, Instantaneo
3. Click "Rapido" preset - verify sliders change to 30s/60s
4. Move sliders manually - verify values update
5. Send data messages in collecting_data mode
6. Verify timeline shows classified messages

**Test 5: Tokens tab per-model (SC6)**
1. After sending some messages, check Tokens tab
2. Verify per-model table shows Haiku and/or Sonnet rows
3. Verify Input and Output columns are separate
4. Verify per-turn breakdown shows model badges

**Test 6: Backward compatibility**
1. Start a new session with NO CRM agents enabled
2. Complete a normal conversation flow
3. Verify everything works as before Phase 15.6
  </how-to-verify>
  <resume-signal>Type "approved" to complete the phase, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
All 6 success criteria verified by human testing:
1. Tab Tools muestra que tools se ejecutarian (dry-run) con inputs/outputs simulados
2. Toggle permite ejecutar tools reales desde sandbox (modo live)
3. Agentes separados: conversacional (flujo de venta) vs CRM (operaciones de datos)
4. Debug panel permite ver hasta 3 tabs simultaneamente
5. Tab Ingest permite configurar timers (ej: 10s en vez de 6min) para testing rapido
6. Tab Tokens desglosa uso por modelo (Haiku vs Sonnet) con costos distintos
</verification>

<success_criteria>
All 6 Phase 15.6 success criteria pass human verification.
</success_criteria>

<output>
After completion, create `.planning/phases/15.6-sandbox-evolution/15.6-06-SUMMARY.md`
</output>
