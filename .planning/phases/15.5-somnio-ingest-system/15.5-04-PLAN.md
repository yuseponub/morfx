---
phase: 15.5-somnio-ingest-system
plan: 04
type: execute
wave: 4
depends_on: ["15.5-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User verifies silent accumulation in sandbox"
    - "User verifies question response during ingest"
    - "User verifies mixto handling (data + response)"
    - "User verifies ingest status display in Estado tab"
---

<objective>
Human verification of Somnio Ingest System end-to-end

Purpose: Validate all INGS-* requirements work correctly in the sandbox
Output: User confirmation that ingest system meets all success criteria
</objective>

<execution_context>
@/home/jose147/.claude/get-shit-done/workflows/execute-plan.md
@/home/jose147/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15.5-somnio-ingest-system/15.5-CONTEXT.md
@.planning/phases/15.5-somnio-ingest-system/15.5-01-SUMMARY.md
@.planning/phases/15.5-somnio-ingest-system/15.5-02-SUMMARY.md
@.planning/phases/15.5-somnio-ingest-system/15.5-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Start dev server and prepare sandbox</name>
  <files></files>
  <action>
1. Kill any existing dev server and start fresh:
   ```bash
   pkill -f "next dev" 2>/dev/null; sleep 2; cd /mnt/c/Users/Usuario/Proyectos/morfx-new && npm run dev &
   ```

2. Wait for server to start (check for "Ready" message)

3. Open browser to sandbox:
   - Navigate to http://localhost:3020/sandbox
   - Select "somnio-sales-v1" agent
  </action>
  <verify>
Server running: `curl -s http://localhost:3020/sandbox | head -c 100`
  </verify>
  <done>
Dev server running and sandbox accessible
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Somnio Ingest System with silent accumulation, question response, and timer logic
  </what-built>
  <how-to-verify>
## Test 1: Silent Accumulation (INGS-02)

1. Start new sandbox session
2. First, trigger collecting_data mode:
   - Send: "Hola"
   - Wait for response
   - Send: "Si, quiero comprarlo"
   - Wait for collecting_data templates

3. Now test silent accumulation:
   - Send: "Jose Romero"
   - **Expected:** NO response from agent (silent), Estado tab shows datos_capturados with nombre
   - Send: "Bogota"
   - **Expected:** NO response (silent), Estado shows ciudad added
   - Send: "Calle 123 #45-67"
   - **Expected:** NO response (silent), Estado shows direccion added

4. Check Estado tab:
   - Should show ingestStatus with active=true
   - Should show fieldsAccumulated growing
   - Should show lastClassification='datos'

## Test 2: Question Response During Ingest (INGS-03)

1. While still in collecting_data (from Test 1):
   - Send: "Cuanto cuesta el envio?"
   - **Expected:** Agent RESPONDS with shipping/price info
   - Estado still shows datos_capturados preserved

2. Check that data accumulation continued:
   - Previous fields still present
   - Mode still collecting_data

## Test 3: Mixto Handling (INGS-01)

1. Start new session, get to collecting_data mode
2. Send: "Maria Garcia, hacen envios a Medellin?"
   - **Expected:** Agent extracts nombre+ciudad AND responds to shipping question
   - Estado shows nombre="Maria Garcia", ciudad="Medellin"
   - Response includes shipping info

## Test 4: Implicit Yes (INGS-05)

1. Start NEW session (click "Nueva sesion")
2. Send: "Hola"
3. Agent responds with greeting
4. Send: "Juan Perez de Cali en la carrera 5 #10-20"
   - **Expected:** Agent transitions to collecting_data mode
   - Sends collecting_data templates
   - Extracts all data from message (nombre, ciudad, direccion)
   - Estado shows datosCapturados populated

## Test 5: Irrelevante Messages

1. In collecting_data mode:
   - Send: "Ok"
   - **Expected:** NO response (silent), no effect on data

2. Send: "Perfecto"
   - **Expected:** NO response (silent)

3. Check Estado:
   - ingestStatus.lastClassification should be 'irrelevante'
   - Timer state unchanged
  </how-to-verify>
  <resume-signal>
Type "approved" if all 5 tests pass, or describe which tests failed and the observed behavior
  </resume-signal>
</task>

</tasks>

<verification>
User has verified all 5 test scenarios in the sandbox
</verification>

<success_criteria>
- INGS-01: Classifier detects datos/pregunta/mixto/irrelevante correctly
- INGS-02: Silent accumulation works (no response on datos)
- INGS-03: Questions get normal responses
- INGS-04: Timer logic visible in Estado (6min partial vs 10min no-data)
- INGS-05: Implicit yes triggers collecting_data + data extraction
</success_criteria>

<output>
After completion, create `.planning/phases/15.5-somnio-ingest-system/15.5-04-SUMMARY.md`
</output>
