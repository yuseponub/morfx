---
phase: 15.6-sandbox-evolution
plan: 04
subsystem: ui
tags: [react, sandbox, debug-panel, ingest, tokens, toggle-group, slider, date-fns]

# Dependency graph
requires:
  - phase: 15.6-01
    provides: "IngestTimelineEntry, IngestStatus, ModelTokenEntry, TokenInfo types"
  - phase: 15.6-02
    provides: "PanelContainer with ingest placeholder, multi-panel grid layout"
provides:
  - "IngestTab component with status grid, timeline, and timer controls"
  - "Enhanced TokensTab with per-model breakdown (Haiku vs Sonnet)"
  - "Timer presets (Real/Rapido/Instantaneo) with slider fine-tuning"
affects: ["15.6-05", "15.6-06"]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Timer presets with ToggleGroup + Slider fine-tuning pattern"
    - "Per-model token aggregation from ModelTokenEntry arrays"
    - "Classification color mapping for ingest timeline badges"

key-files:
  created:
    - "src/app/(dashboard)/sandbox/components/debug-panel/ingest-tab.tsx"
  modified:
    - "src/app/(dashboard)/sandbox/components/debug-panel/tokens-tab.tsx"
    - "src/app/(dashboard)/sandbox/components/debug-panel/panel-container.tsx"

key-decisions:
  - "Timer presets: Real (360s/600s), Rapido (30s/60s), Instantaneo (0s/0s)"
  - "Slider ranges: partial 0-600s step 10, noData 0-900s step 10"
  - "Model display names: claude-haiku-4-5 -> Haiku, claude-sonnet-4-5 -> Sonnet"
  - "Model color coding: Haiku=sky, Sonnet=violet for visual distinction"
  - "Per-turn model badges show compact format: Haiku: 120in/45out"

patterns-established:
  - "Timer preset + slider: ToggleGroup selects preset, sliders allow override"
  - "Model aggregation: iterate turns, accumulate per-model input/output across all entries"

# Metrics
duration: 9min
completed: 2026-02-07
---

# Phase 15.6 Plan 04: Ingest & Tokens Tabs Summary

**IngestTab with status/timeline/timer-presets and TokensTab with per-model Haiku/Sonnet breakdown table**

## Performance

- **Duration:** 9 min
- **Started:** 2026-02-07T21:36:57Z
- **Completed:** 2026-02-07T21:46:09Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments
- IngestTab shows real-time status grid (active/inactive, fields accumulated, last classification, timer countdown)
- Scrollable timeline of classified messages with color-coded badges and extracted fields
- Timer presets (Real/Rapido/Instantaneo) with ToggleGroup + fine-tune sliders for partial and no_data timers
- TokensTab now shows per-model summary table (Modelo | Input | Output | Total) with Haiku and Sonnet rows
- Per-turn model badges show input/output split per model used
- Both tabs wired into PanelContainer and render correctly

## Task Commits

Each task was committed atomically:

1. **Task 1: Create IngestTab with status, timeline, and timer controls** - `d970af8` (feat)
2. **Task 2: Enhance TokensTab with per-model breakdown table** - `28ee337` (feat)

## Files Created/Modified
- `src/app/(dashboard)/sandbox/components/debug-panel/ingest-tab.tsx` - IngestTab component with StatusGrid, Timeline, TimerControls sub-components
- `src/app/(dashboard)/sandbox/components/debug-panel/tokens-tab.tsx` - Enhanced with ModelSummaryTable, TurnModelBadges, aggregateByModel logic
- `src/app/(dashboard)/sandbox/components/debug-panel/panel-container.tsx` - Replaced ingest placeholder with IngestTab import and rendering

## Decisions Made
- Timer preset values: Real (360s/600s), Rapido (30s/60s), Instantaneo (0s/0s) -- matching plan specification
- Slider ranges allow fine-tuning beyond preset values: partial 0-600s, noData 0-900s, step 10s
- Model color coding: Haiku = sky blue, Sonnet = violet for easy visual distinction in both table and badges
- Per-turn badges use compact format "Haiku: 120in/45out" to fit in small spaces
- Backward compatible: turn.tokens.models uses optional chaining for turns without model data

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

- Pre-existing TypeScript error in sandbox-layout.tsx (missing CRM agent props from Plan 03's SandboxHeader changes) -- not introduced by this plan, will be resolved in Plan 05 when CRM agents are wired into the sandbox layout.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- IngestTab and TokensTab ready for integration with sandbox engine
- Plan 05 (Sandbox Engine Wiring) will connect these tabs to real data flow
- Pre-existing TS error in sandbox-layout.tsx needs resolution in Plan 05

---
*Phase: 15.6-sandbox-evolution*
*Completed: 2026-02-07*
