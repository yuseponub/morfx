---
phase: 15-agent-sandbox
plan: 04
type: execute
wave: 3
depends_on: ["15-02", "15-03"]
files_modified:
  - src/app/(dashboard)/sandbox/components/sandbox-layout.tsx
  - src/app/(dashboard)/sandbox/components/sandbox-header.tsx
  - src/app/(dashboard)/sandbox/components/session-controls.tsx
  - src/app/(dashboard)/sandbox/components/saved-sessions-modal.tsx
  - src/components/layout/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can save current session with custom name"
    - "User can load a previously saved session"
    - "User can create a new session (with confirmation)"
    - "Sessions are persisted in localStorage"
    - "User can access /sandbox from sidebar navigation"
  artifacts:
    - path: "src/app/(dashboard)/sandbox/components/session-controls.tsx"
      provides: "Session management toolbar buttons"
      exports: ["SessionControls"]
    - path: "src/app/(dashboard)/sandbox/components/saved-sessions-modal.tsx"
      provides: "Modal for listing and loading saved sessions"
      exports: ["SavedSessionsModal"]
    - path: "src/components/layout/sidebar.tsx"
      provides: "Sidebar with sandbox link"
      contains: "/sandbox"
  key_links:
    - from: "src/app/(dashboard)/sandbox/components/sandbox-layout.tsx"
      to: "src/app/(dashboard)/sandbox/components/debug-panel/debug-tabs.tsx"
      via: "Component integration"
      pattern: "DebugTabs"
    - from: "src/app/(dashboard)/sandbox/components/session-controls.tsx"
      to: "src/lib/sandbox/sandbox-session.ts"
      via: "localStorage operations"
      pattern: "saveSandboxSession|loadSandboxSessions"
---

<objective>
Complete the sandbox UI by integrating the debug panel, adding session management controls, and adding sidebar navigation.

Purpose: Enables full testing workflow - save sessions for later review, load previous sessions to continue testing, and easy access from sidebar.
Output: Fully functional sandbox with session persistence and navigation.
</objective>

<execution_context>
@/home/jose147/.claude/get-shit-done/workflows/execute-plan.md
@/home/jose147/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/15-agent-sandbox/15-CONTEXT.md
@.planning/phases/15-agent-sandbox/15-02-SUMMARY.md
@.planning/phases/15-agent-sandbox/15-03-SUMMARY.md
@src/lib/sandbox/sandbox-session.ts
@src/components/layout/sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create session controls and saved sessions modal</name>
  <files>
    src/app/(dashboard)/sandbox/components/session-controls.tsx
    src/app/(dashboard)/sandbox/components/saved-sessions-modal.tsx
  </files>
  <action>
Create `src/app/(dashboard)/sandbox/components/session-controls.tsx`:

```typescript
'use client'

/**
 * Session Controls Component
 * Phase 15: Agent Sandbox
 *
 * Toolbar buttons for session management:
 * - New Session (with confirmation)
 * - Save Session
 * - Load Session (opens modal)
 */

import { useState } from 'react'
import { Plus, Save, FolderOpen } from 'lucide-react'
import { Button } from '@/components/ui/button'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { SavedSessionsModal } from './saved-sessions-modal'
import type { SavedSandboxSession, SandboxMessage, SandboxState, DebugTurn } from '@/lib/sandbox/types'
import { saveSandboxSession, generateSessionId } from '@/lib/sandbox/sandbox-session'
import { toast } from 'sonner'

interface SessionControlsProps {
  agentId: string
  messages: SandboxMessage[]
  state: SandboxState
  debugTurns: DebugTurn[]
  totalTokens: number
  hasMessages: boolean
  onNewSession: () => void
  onLoadSession: (session: SavedSandboxSession) => void
}

export function SessionControls({
  agentId,
  messages,
  state,
  debugTurns,
  totalTokens,
  hasMessages,
  onNewSession,
  onLoadSession,
}: SessionControlsProps) {
  const [showNewConfirm, setShowNewConfirm] = useState(false)
  const [showSaveDialog, setShowSaveDialog] = useState(false)
  const [showLoadModal, setShowLoadModal] = useState(false)
  const [sessionName, setSessionName] = useState('')

  const handleNewSession = () => {
    if (hasMessages) {
      setShowNewConfirm(true)
    } else {
      onNewSession()
    }
  }

  const handleConfirmNew = () => {
    setShowNewConfirm(false)
    onNewSession()
  }

  const handleSave = () => {
    if (!sessionName.trim()) {
      toast.error('Por favor ingresa un nombre para la sesion')
      return
    }

    const session: SavedSandboxSession = {
      id: generateSessionId(),
      name: sessionName.trim(),
      agentId,
      messages,
      state,
      debugTurns,
      totalTokens,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
    }

    saveSandboxSession(session)
    toast.success('Sesion guardada')
    setShowSaveDialog(false)
    setSessionName('')
  }

  return (
    <>
      <div className="flex items-center gap-2">
        <Button variant="outline" size="sm" onClick={handleNewSession}>
          <Plus className="h-4 w-4 mr-1.5" />
          Nueva
        </Button>

        <Button
          variant="outline"
          size="sm"
          onClick={() => setShowSaveDialog(true)}
          disabled={!hasMessages}
        >
          <Save className="h-4 w-4 mr-1.5" />
          Guardar
        </Button>

        <Button variant="outline" size="sm" onClick={() => setShowLoadModal(true)}>
          <FolderOpen className="h-4 w-4 mr-1.5" />
          Cargar
        </Button>
      </div>

      {/* New Session Confirmation */}
      <AlertDialog open={showNewConfirm} onOpenChange={setShowNewConfirm}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Crear nueva sesion?</AlertDialogTitle>
            <AlertDialogDescription>
              Tienes una conversacion activa. Al crear una nueva sesion perderas
              los mensajes actuales a menos que los guardes primero.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>Cancelar</AlertDialogCancel>
            <AlertDialogAction onClick={handleConfirmNew}>
              Crear nueva
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Save Session Dialog */}
      <Dialog open={showSaveDialog} onOpenChange={setShowSaveDialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Guardar sesion</DialogTitle>
            <DialogDescription>
              Elige un nombre para identificar esta sesion de prueba.
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label htmlFor="session-name">Nombre de la sesion</Label>
              <Input
                id="session-name"
                value={sessionName}
                onChange={(e) => setSessionName(e.target.value)}
                placeholder="Ej: Test flujo de compra"
                onKeyDown={(e) => e.key === 'Enter' && handleSave()}
              />
            </div>

            <div className="text-sm text-muted-foreground">
              {messages.length} mensajes | {totalTokens.toLocaleString()} tokens
            </div>
          </div>

          <DialogFooter>
            <Button variant="outline" onClick={() => setShowSaveDialog(false)}>
              Cancelar
            </Button>
            <Button onClick={handleSave}>Guardar</Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Load Sessions Modal */}
      <SavedSessionsModal
        open={showLoadModal}
        onOpenChange={setShowLoadModal}
        onLoadSession={(session) => {
          onLoadSession(session)
          setShowLoadModal(false)
        }}
      />
    </>
  )
}
```

Create `src/app/(dashboard)/sandbox/components/saved-sessions-modal.tsx`:

```typescript
'use client'

/**
 * Saved Sessions Modal Component
 * Phase 15: Agent Sandbox
 *
 * Lists saved sessions with option to load or delete.
 */

import { useState, useEffect } from 'react'
import { format } from 'date-fns'
import { Trash2, MessageSquare, Coins } from 'lucide-react'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog'
import { Button } from '@/components/ui/button'
import { ScrollArea } from '@/components/ui/scroll-area'
import type { SavedSandboxSession } from '@/lib/sandbox/types'
import { loadSandboxSessions, deleteSandboxSession } from '@/lib/sandbox/sandbox-session'
import { toast } from 'sonner'

interface SavedSessionsModalProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  onLoadSession: (session: SavedSandboxSession) => void
}

export function SavedSessionsModal({
  open,
  onOpenChange,
  onLoadSession,
}: SavedSessionsModalProps) {
  const [sessions, setSessions] = useState<SavedSandboxSession[]>([])
  const [sessionToDelete, setSessionToDelete] = useState<SavedSandboxSession | null>(null)

  // Load sessions when modal opens
  useEffect(() => {
    if (open) {
      setSessions(loadSandboxSessions())
    }
  }, [open])

  const handleDelete = (session: SavedSandboxSession) => {
    setSessionToDelete(session)
  }

  const confirmDelete = () => {
    if (sessionToDelete) {
      deleteSandboxSession(sessionToDelete.id)
      setSessions(sessions.filter(s => s.id !== sessionToDelete.id))
      toast.success('Sesion eliminada')
      setSessionToDelete(null)
    }
  }

  return (
    <>
      <Dialog open={open} onOpenChange={onOpenChange}>
        <DialogContent className="sm:max-w-[500px]">
          <DialogHeader>
            <DialogTitle>Sesiones guardadas</DialogTitle>
            <DialogDescription>
              Selecciona una sesion para continuar la prueba.
            </DialogDescription>
          </DialogHeader>

          {sessions.length === 0 ? (
            <div className="py-8 text-center text-sm text-muted-foreground">
              No hay sesiones guardadas
            </div>
          ) : (
            <ScrollArea className="max-h-[400px]">
              <div className="space-y-2 pr-4">
                {sessions.map(session => (
                  <div
                    key={session.id}
                    className="flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors"
                  >
                    <button
                      className="flex-1 text-left"
                      onClick={() => onLoadSession(session)}
                    >
                      <div className="font-medium">{session.name}</div>
                      <div className="flex items-center gap-3 mt-1 text-xs text-muted-foreground">
                        <span className="flex items-center gap-1">
                          <MessageSquare className="h-3 w-3" />
                          {session.messages.length}
                        </span>
                        <span className="flex items-center gap-1">
                          <Coins className="h-3 w-3" />
                          {session.totalTokens.toLocaleString()}
                        </span>
                        <span>
                          {format(new Date(session.createdAt), 'dd/MM HH:mm')}
                        </span>
                      </div>
                    </button>

                    <Button
                      variant="ghost"
                      size="icon"
                      className="shrink-0 text-muted-foreground hover:text-destructive"
                      onClick={(e) => {
                        e.stopPropagation()
                        handleDelete(session)
                      }}
                    >
                      <Trash2 className="h-4 w-4" />
                    </Button>
                  </div>
                ))}
              </div>
            </ScrollArea>
          )}
        </DialogContent>
      </Dialog>

      {/* Delete Confirmation */}
      <AlertDialog open={!!sessionToDelete} onOpenChange={() => setSessionToDelete(null)}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Eliminar sesion?</AlertDialogTitle>
            <AlertDialogDescription>
              Esto eliminara permanentemente la sesion "{sessionToDelete?.name}".
              Esta accion no se puede deshacer.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>Cancelar</AlertDialogCancel>
            <AlertDialogAction
              onClick={confirmDelete}
              className="bg-destructive text-destructive-foreground hover:bg-destructive/90"
            >
              Eliminar
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  )
}
```
  </action>
  <verify>
Run `npx tsc --noEmit src/app/\(dashboard\)/sandbox/components/session-controls.tsx` to verify compilation.
Verify toast import from sonner works.
  </verify>
  <done>
Session controls component with New, Save, Load buttons.
Save dialog prompts for session name.
Load modal shows list of saved sessions with delete option.
All actions have confirmation dialogs per CONTEXT.md requirement.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update sandbox layout to integrate all components</name>
  <files>
    src/app/(dashboard)/sandbox/components/sandbox-layout.tsx
    src/app/(dashboard)/sandbox/components/sandbox-header.tsx
  </files>
  <action>
**IMPORTANT: This task REPLACES the entire sandbox-layout.tsx file created in Plan 15-02.**

Why full replacement instead of incremental edit:
- Plan 15-02 created the initial layout with a placeholder div for the debug panel
- This plan adds: session management props, load session handler, debug panel integration
- The changes touch nearly every section of the component (state, props, callbacks, JSX)
- A full replacement is cleaner than patching 10+ sections incrementally

Replace `src/app/(dashboard)/sandbox/components/sandbox-layout.tsx` entirely with:

```typescript
'use client'

/**
 * Sandbox Layout Component
 * Phase 15: Agent Sandbox
 *
 * Complete layout with chat, debug panel, and session management.
 */

import { useState, useCallback } from 'react'
import { Allotment } from 'allotment'
import 'allotment/dist/style.css'
import { SandboxHeader } from './sandbox-header'
import { SandboxChat } from './sandbox-chat'
import { DebugTabs } from './debug-panel'
import type { ActiveSandboxSession, SandboxState, DebugTurn, SandboxMessage, SavedSandboxSession } from '@/lib/sandbox/types'
import { SandboxEngine } from '@/lib/sandbox/sandbox-engine'
import { getLastAgentId, setLastAgentId } from '@/lib/sandbox/sandbox-session'

// Initial agent - will be expanded when more agents are registered
const DEFAULT_AGENT_ID = 'somnio-sales-v1'

export function SandboxLayout() {
  // Session state
  const [agentId, setAgentId] = useState<string>(getLastAgentId() ?? DEFAULT_AGENT_ID)
  const [messages, setMessages] = useState<SandboxMessage[]>([])
  const [state, setState] = useState<SandboxState>(() => new SandboxEngine().getInitialState())
  const [debugTurns, setDebugTurns] = useState<DebugTurn[]>([])
  const [totalTokens, setTotalTokens] = useState(0)
  const [isTyping, setIsTyping] = useState(false)

  // Engine instance
  const [engine] = useState(() => new SandboxEngine())

  // Handle message send
  const handleSendMessage = useCallback(async (content: string) => {
    // 1. Add user message immediately
    const userMessage: SandboxMessage = {
      id: `msg-${Date.now()}-user`,
      role: 'user',
      content,
      timestamp: new Date().toISOString(),
    }
    setMessages(prev => [...prev, userMessage])

    // 2. Show typing indicator
    setIsTyping(true)

    // 3. Build history for engine
    const history = messages.map(m => ({ role: m.role, content: m.content }))
    history.push({ role: 'user', content })

    // 4. Process message
    const turnNumber = debugTurns.length + 1
    const result = await engine.processMessage(content, state, history, turnNumber)

    // 5. Hide typing and add response messages with delays
    if (result.success && result.messages.length > 0) {
      for (let i = 0; i < result.messages.length; i++) {
        // Simulate delay (2-6 seconds) between messages per CONTEXT.md
        const delay = 2000 + Math.random() * 4000
        await new Promise(resolve => setTimeout(resolve, delay))

        const assistantMessage: SandboxMessage = {
          id: `msg-${Date.now()}-assistant-${i}`,
          role: 'assistant',
          content: result.messages[i],
          timestamp: new Date().toISOString(),
        }
        setMessages(prev => [...prev, assistantMessage])
      }
    }

    setIsTyping(false)

    // 6. Update state and debug info
    setState(result.newState)
    setDebugTurns(prev => [...prev, result.debugTurn])
    setTotalTokens(prev => prev + result.debugTurn.tokens.tokensUsed)
  }, [messages, state, debugTurns, engine])

  // Handle session reset
  const handleReset = useCallback(() => {
    setMessages([])
    setState(engine.getInitialState())
    setDebugTurns([])
    setTotalTokens(0)
    setIsTyping(false)
  }, [engine])

  // Handle new session (same as reset but through controls)
  const handleNewSession = useCallback(() => {
    handleReset()
  }, [handleReset])

  // Handle agent change
  const handleAgentChange = useCallback((newAgentId: string) => {
    setAgentId(newAgentId)
    setLastAgentId(newAgentId)
  }, [])

  // Handle state edit from debug panel
  const handleStateEdit = useCallback((newState: SandboxState) => {
    setState(newState)
  }, [])

  // Handle loading a saved session
  const handleLoadSession = useCallback((session: SavedSandboxSession) => {
    setAgentId(session.agentId)
    setMessages(session.messages)
    setState(session.state)
    setDebugTurns(session.debugTurns)
    setTotalTokens(session.totalTokens)
    setIsTyping(false)
  }, [])

  return (
    <div className="flex flex-col h-full">
      <SandboxHeader
        agentId={agentId}
        onAgentChange={handleAgentChange}
        onReset={handleReset}
        onNewSession={handleNewSession}
        onLoadSession={handleLoadSession}
        totalTokens={totalTokens}
        messageCount={messages.length}
        messages={messages}
        state={state}
        debugTurns={debugTurns}
      />

      <div className="flex-1 min-h-0">
        <Allotment defaultSizes={[60, 40]} minSize={300}>
          <Allotment.Pane>
            <SandboxChat
              messages={messages}
              isTyping={isTyping}
              onSendMessage={handleSendMessage}
              agentId={agentId}
              currentMode={state.currentMode}
            />
          </Allotment.Pane>
          <Allotment.Pane snap>
            <DebugTabs
              debugTurns={debugTurns}
              state={state}
              onStateEdit={handleStateEdit}
              totalTokens={totalTokens}
            />
          </Allotment.Pane>
        </Allotment>
      </div>
    </div>
  )
}
```

Similarly, replace `src/app/(dashboard)/sandbox/components/sandbox-header.tsx` entirely (same reason - adds session control integration):

```typescript
'use client'

/**
 * Sandbox Header Component
 * Phase 15: Agent Sandbox
 *
 * Toolbar with agent selector, session controls, and stats.
 */

import { Bot, RotateCcw, Coins } from 'lucide-react'
import { Button } from '@/components/ui/button'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from '@/components/ui/alert-dialog'
import { SessionControls } from './session-controls'
import { setLastAgentId } from '@/lib/sandbox/sandbox-session'
import type { SandboxMessage, SandboxState, DebugTurn, SavedSandboxSession } from '@/lib/sandbox/types'

// Available agents - will grow as more agents are registered
const AVAILABLE_AGENTS = [
  { id: 'somnio-sales-v1', name: 'Somnio Sales Agent' },
]

interface SandboxHeaderProps {
  agentId: string
  onAgentChange: (agentId: string) => void
  onReset: () => void
  onNewSession: () => void
  onLoadSession: (session: SavedSandboxSession) => void
  totalTokens: number
  messageCount: number
  messages: SandboxMessage[]
  state: SandboxState
  debugTurns: DebugTurn[]
}

export function SandboxHeader({
  agentId,
  onAgentChange,
  onReset,
  onNewSession,
  onLoadSession,
  totalTokens,
  messageCount,
  messages,
  state,
  debugTurns,
}: SandboxHeaderProps) {
  const handleAgentChange = (newAgentId: string) => {
    setLastAgentId(newAgentId)
    onAgentChange(newAgentId)
  }

  return (
    <div className="flex items-center justify-between px-4 py-3 border-b bg-background">
      {/* Left: Agent selector and status */}
      <div className="flex items-center gap-3">
        <Bot className="h-5 w-5 text-primary" />

        <Select value={agentId} onValueChange={handleAgentChange}>
          <SelectTrigger className="w-[200px]">
            <SelectValue placeholder="Seleccionar agente" />
          </SelectTrigger>
          <SelectContent>
            {AVAILABLE_AGENTS.map(agent => (
              <SelectItem key={agent.id} value={agent.id}>
                {agent.name}
              </SelectItem>
            ))}
          </SelectContent>
        </Select>

        <span className="flex items-center gap-1.5 text-sm text-muted-foreground">
          <span className="inline-block w-2 h-2 rounded-full bg-green-500" />
          Activo
        </span>
      </div>

      {/* Center: Session controls */}
      <SessionControls
        agentId={agentId}
        messages={messages}
        state={state}
        debugTurns={debugTurns}
        totalTokens={totalTokens}
        hasMessages={messageCount > 0}
        onNewSession={onNewSession}
        onLoadSession={onLoadSession}
      />

      {/* Right: Stats and reset */}
      <div className="flex items-center gap-4">
        {/* Token counter */}
        <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
          <Coins className="h-4 w-4" />
          <span>{totalTokens.toLocaleString()} tokens</span>
          <span className="mx-1">|</span>
          <span>{messageCount} mensajes</span>
        </div>

        {/* Reset button with confirmation */}
        <AlertDialog>
          <AlertDialogTrigger asChild>
            <Button variant="outline" size="sm" disabled={messageCount === 0}>
              <RotateCcw className="h-4 w-4 mr-1.5" />
              Resetear
            </Button>
          </AlertDialogTrigger>
          <AlertDialogContent>
            <AlertDialogHeader>
              <AlertDialogTitle>Resetear sesion?</AlertDialogTitle>
              <AlertDialogDescription>
                Esto borrara todos los mensajes y el estado actual de la conversacion.
                Esta accion no se puede deshacer.
              </AlertDialogDescription>
            </AlertDialogHeader>
            <AlertDialogFooter>
              <AlertDialogCancel>Cancelar</AlertDialogCancel>
              <AlertDialogAction onClick={onReset}>
                Resetear
              </AlertDialogAction>
            </AlertDialogFooter>
          </AlertDialogContent>
        </AlertDialog>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
Run `npx tsc --noEmit src/app/\(dashboard\)/sandbox/components/sandbox-layout.tsx` to verify all integrations compile.
Check that DebugTabs import from './debug-panel' resolves correctly.
  </verify>
  <done>
Sandbox layout fully integrated with debug panel.
Header includes session controls (New, Save, Load).
Debug panel receives state and can edit it.
All components properly wired together.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add sandbox link to sidebar navigation</name>
  <files>
    src/components/layout/sidebar.tsx
  </files>
  <action>
Update `src/components/layout/sidebar.tsx` to add the Sandbox navigation link.

**Step 1: Add Bot to imports (line 5)**

Change:
```typescript
import { Building2, MessageSquare, Settings, Users, LogOut, ListTodo, BarChart3 } from 'lucide-react'
```

To:
```typescript
import { Building2, MessageSquare, Settings, Users, LogOut, ListTodo, BarChart3, Bot } from 'lucide-react'
```

**Step 2: Add Sandbox nav item in navItems array (after Analytics, before Equipo - around line 52)**

Insert this new item after the Analytics entry and before the Equipo entry:

```typescript
  {
    href: '/sandbox',
    label: 'Sandbox',
    icon: Bot,
  },
```

The final navItems array should look like:

```typescript
const navItems: NavItem[] = [
  {
    href: '/crm',
    label: 'CRM',
    icon: Building2,
  },
  {
    href: '/whatsapp',
    label: 'WhatsApp',
    icon: MessageSquare,
  },
  {
    href: '/tareas',
    label: 'Tareas',
    icon: ListTodo,
    hasBadge: true,
  },
  {
    href: '/analytics',
    label: 'Analytics',
    icon: BarChart3,
    adminOnly: true,
  },
  {
    href: '/sandbox',
    label: 'Sandbox',
    icon: Bot,
  },
  {
    href: '/settings/workspace/members',
    label: 'Equipo',
    icon: Users,
  },
  {
    href: '/settings',
    label: 'Configuracion',
    icon: Settings,
  },
]
```

The Sandbox link is placed after Analytics (main features) and before Equipo/Settings (configuration). It is visible to all authenticated users since it's a developer/testing tool.
  </action>
  <verify>
Run `npx tsc --noEmit src/components/layout/sidebar.tsx` to verify compilation.
Verify the sidebar renders with 7 navigation items (CRM, WhatsApp, Tareas, Analytics, Sandbox, Equipo, Configuracion).
Navigate to http://localhost:3020 and confirm Sandbox link appears in sidebar.
  </verify>
  <done>
Sidebar navigation includes Sandbox link with Bot icon.
Link positioned after main features, before settings.
Users can access /sandbox from main navigation.
  </done>
</task>

</tasks>

<verification>
1. Navigate to http://localhost:3020/sandbox - full UI renders
2. Chat panel on left, debug panel with 4 tabs on right
3. Click "Nueva" - shows confirmation if messages exist
4. Click "Guardar" - prompts for name and saves to localStorage
5. Click "Cargar" - shows list of saved sessions
6. Can delete sessions from the load modal
7. Sidebar shows "Sandbox" link that navigates to /sandbox
8. State tab edits are reflected in subsequent agent responses
</verification>

<success_criteria>
- Session controls (New, Save, Load) visible in header
- Save dialog accepts custom session name
- Load modal lists saved sessions with delete option
- Confirmation dialogs appear before destructive actions
- Debug panel fully functional with all 4 tabs
- Sidebar includes Sandbox navigation link
- Full round-trip: type message, see response, save session, load session
</success_criteria>

<output>
After completion, create `.planning/phases/15-agent-sandbox/15-04-SUMMARY.md`
</output>
