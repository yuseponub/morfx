---
phase: 08-whatsapp-extended
plan: 09
type: execute
wave: 3
depends_on: ["08-01", "08-02", "08-08"]
files_modified:
  - src/app/super-admin/layout.tsx
  - src/app/super-admin/page.tsx
  - src/app/super-admin/workspaces/page.tsx
  - src/app/super-admin/workspaces/[id]/page.tsx
  - src/app/super-admin/workspaces/[id]/components/workspace-limits-form.tsx
  - src/app/super-admin/costos/page.tsx
  - src/app/actions/super-admin.ts
autonomous: true

must_haves:
  truths:
    - "Only platform owner can access super admin panel"
    - "Super admin can view all workspaces"
    - "Super admin can configure limits per workspace"
    - "Super admin can see consolidated cost dashboard"
    - "Unauthorized users redirected to dashboard"
  artifacts:
    - path: "src/app/super-admin/layout.tsx"
      provides: "Super admin access guard"
      min_lines: 20
    - path: "src/app/super-admin/workspaces/[id]/components/workspace-limits-form.tsx"
      provides: "Workspace configuration form"
      min_lines: 80
  key_links:
    - from: "super-admin/layout.tsx"
      to: "MORFX_OWNER_USER_ID env var"
      via: "user.id comparison"
      pattern: "MORFX_OWNER_USER_ID"
    - from: "super-admin/costos/page.tsx"
      to: "src/app/actions/usage.ts"
      via: "getAllWorkspacesUsage action"
      pattern: "getAllWorkspacesUsage"
---

<objective>
Build the Super Admin panel for platform-wide configuration and visibility.

Purpose: Allow MorfX owner to configure workspace limits and view consolidated costs.
Output: Protected super admin routes with workspace configuration and cost overview.
</objective>

<execution_context>
@/home/jose147/.claude/get-shit-done/workflows/execute-plan.md
@/home/jose147/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-whatsapp-extended/08-CONTEXT.md
@.planning/phases/08-whatsapp-extended/08-RESEARCH.md
@src/app/actions/usage.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Super Admin Layout and Access Guard</name>
  <files>
    src/app/super-admin/layout.tsx
    src/app/super-admin/page.tsx
    src/app/actions/super-admin.ts
  </files>
  <action>
**Create src/app/super-admin/layout.tsx:**

```typescript
import { redirect } from 'next/navigation'
import { createClient } from '@/lib/supabase/server'
import Link from 'next/link'
import { Button } from '@/components/ui/button'
import { Building2, DollarSign, Settings, ArrowLeft } from 'lucide-react'

export default async function SuperAdminLayout({
  children
}: {
  children: React.ReactNode
}) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  // Check if user is MorfX platform owner
  const MORFX_OWNER_ID = process.env.MORFX_OWNER_USER_ID

  if (!MORFX_OWNER_ID || user.id !== MORFX_OWNER_ID) {
    redirect('/dashboard')  // Unauthorized - redirect to normal dashboard
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Super Admin Header */}
      <header className="border-b bg-card">
        <div className="container flex items-center justify-between h-14">
          <div className="flex items-center gap-4">
            <Link href="/dashboard">
              <Button variant="ghost" size="sm">
                <ArrowLeft className="h-4 w-4 mr-2" />
                Volver
              </Button>
            </Link>
            <div className="flex items-center gap-2">
              <Settings className="h-5 w-5 text-primary" />
              <span className="font-semibold">Super Admin</span>
            </div>
          </div>
        </div>
      </header>

      {/* Navigation */}
      <div className="border-b">
        <div className="container">
          <nav className="flex gap-4 h-12 items-center">
            <Link
              href="/super-admin"
              className="text-sm font-medium text-muted-foreground hover:text-foreground"
            >
              Overview
            </Link>
            <Link
              href="/super-admin/workspaces"
              className="text-sm font-medium text-muted-foreground hover:text-foreground flex items-center gap-1"
            >
              <Building2 className="h-4 w-4" />
              Workspaces
            </Link>
            <Link
              href="/super-admin/costos"
              className="text-sm font-medium text-muted-foreground hover:text-foreground flex items-center gap-1"
            >
              <DollarSign className="h-4 w-4" />
              Costos
            </Link>
          </nav>
        </div>
      </div>

      {/* Content */}
      <main className="container py-6">
        {children}
      </main>
    </div>
  )
}
```

**Create src/app/super-admin/page.tsx:**

```typescript
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { getAllWorkspacesUsage } from '@/app/actions/usage'
import { Building2, MessageSquare, DollarSign } from 'lucide-react'

export default async function SuperAdminPage() {
  const workspaces = await getAllWorkspacesUsage('month')

  const totalWorkspaces = workspaces.length
  const totalMessages = workspaces.reduce((sum, ws) => sum + ws.totalMessages, 0)
  const totalCost = workspaces.reduce((sum, ws) => sum + ws.totalCost, 0)

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Panel de Super Admin</h1>
        <p className="text-muted-foreground">
          Vision general de la plataforma MorfX
        </p>
      </div>

      <div className="grid gap-4 md:grid-cols-3">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Workspaces</CardTitle>
            <Building2 className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{totalWorkspaces}</div>
            <p className="text-xs text-muted-foreground">
              Workspaces activos
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Mensajes (mes)</CardTitle>
            <MessageSquare className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{totalMessages.toLocaleString()}</div>
            <p className="text-xs text-muted-foreground">
              Total de mensajes este mes
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Costos (mes)</CardTitle>
            <DollarSign className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              ${totalCost.toFixed(2)}
            </div>
            <p className="text-xs text-muted-foreground">
              USD estimados
            </p>
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
```

**Create src/app/actions/super-admin.ts:**

```typescript
'use server'

import { createClient, createAdminClient } from '@/lib/supabase/server'
import { WorkspaceLimits } from '@/lib/whatsapp/types'
import { revalidatePath } from 'next/cache'

// Verify super admin access
async function verifySuperAdmin() {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  const MORFX_OWNER_ID = process.env.MORFX_OWNER_USER_ID
  if (!user || user.id !== MORFX_OWNER_ID) {
    throw new Error('Unauthorized')
  }

  return user
}

// Get all workspaces for super admin
export async function getAllWorkspaces() {
  await verifySuperAdmin()
  const adminClient = await createAdminClient()

  const { data, error } = await adminClient
    .from('workspaces')
    .select(`
      id,
      name,
      created_at,
      workspace_members(count)
    `)
    .order('created_at', { ascending: false })

  if (error) throw error
  return (data || []).map(ws => ({
    ...ws,
    member_count: ws.workspace_members?.[0]?.count || 0
  }))
}

// Get workspace limits
export async function getWorkspaceLimits(workspaceId: string): Promise<WorkspaceLimits | null> {
  await verifySuperAdmin()
  const adminClient = await createAdminClient()

  const { data } = await adminClient
    .from('workspace_limits')
    .select('*')
    .eq('workspace_id', workspaceId)
    .single()

  return data
}

// Update workspace limits
export async function updateWorkspaceLimits(
  workspaceId: string,
  limits: Partial<Omit<WorkspaceLimits, 'workspace_id' | 'updated_at' | 'updated_by'>>
): Promise<void> {
  const user = await verifySuperAdmin()
  const adminClient = await createAdminClient()

  const { error } = await adminClient
    .from('workspace_limits')
    .upsert({
      workspace_id: workspaceId,
      ...limits,
      updated_at: new Date().toISOString(),
      updated_by: user.id
    }, {
      onConflict: 'workspace_id'
    })

  if (error) throw error
  revalidatePath(`/super-admin/workspaces/${workspaceId}`)
}

// Get workspace details
export async function getWorkspaceDetails(workspaceId: string) {
  await verifySuperAdmin()
  const adminClient = await createAdminClient()

  const { data: workspace } = await adminClient
    .from('workspaces')
    .select(`
      *,
      workspace_members(
        user_id,
        role,
        profiles!user_id(email, full_name)
      )
    `)
    .eq('id', workspaceId)
    .single()

  const { data: limits } = await adminClient
    .from('workspace_limits')
    .select('*')
    .eq('workspace_id', workspaceId)
    .single()

  return { workspace, limits }
}
```

Add MORFX_OWNER_USER_ID to .env.local (the owner needs to set their own user ID).
  </action>
  <verify>Run `pnpm tsc --noEmit` to verify layout compiles. Test that non-owner users are redirected.</verify>
  <done>Super admin layout with access guard using MORFX_OWNER_USER_ID env var. Overview page shows platform totals. Server Actions for workspace management created.</done>
</task>

<task type="auto">
  <name>Task 2: Workspace List and Configuration Page</name>
  <files>
    src/app/super-admin/workspaces/page.tsx
    src/app/super-admin/workspaces/[id]/page.tsx
    src/app/super-admin/workspaces/[id]/components/workspace-limits-form.tsx
  </files>
  <action>
**Create src/app/super-admin/workspaces/page.tsx:**

```typescript
import Link from 'next/link'
import { getAllWorkspaces } from '@/app/actions/super-admin'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { ChevronRight, Users } from 'lucide-react'

export default async function WorkspacesPage() {
  const workspaces = await getAllWorkspaces()

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Workspaces</h1>
        <p className="text-muted-foreground">
          Gestiona configuraciones por workspace
        </p>
      </div>

      <div className="space-y-3">
        {workspaces.map((workspace) => (
          <Link key={workspace.id} href={`/super-admin/workspaces/${workspace.id}`}>
            <Card className="hover:bg-muted/50 transition-colors cursor-pointer">
              <CardContent className="flex items-center justify-between py-4">
                <div>
                  <h3 className="font-medium">{workspace.name}</h3>
                  <div className="flex items-center gap-2 text-sm text-muted-foreground">
                    <Users className="h-4 w-4" />
                    {workspace.member_count} miembros
                    <span className="mx-1">Â·</span>
                    {new Date(workspace.created_at).toLocaleDateString('es-CO')}
                  </div>
                </div>
                <ChevronRight className="h-5 w-5 text-muted-foreground" />
              </CardContent>
            </Card>
          </Link>
        ))}
      </div>
    </div>
  )
}
```

**Create src/app/super-admin/workspaces/[id]/page.tsx:**

```typescript
import { notFound } from 'next/navigation'
import { getWorkspaceDetails } from '@/app/actions/super-admin'
import { WorkspaceLimitsForm } from './components/workspace-limits-form'
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'
import { ArrowLeft, Users } from 'lucide-react'
import Link from 'next/link'
import { Button } from '@/components/ui/button'

interface Props {
  params: Promise<{ id: string }>
}

export default async function WorkspaceConfigPage({ params }: Props) {
  const { id } = await params
  const { workspace, limits } = await getWorkspaceDetails(id)

  if (!workspace) {
    notFound()
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center gap-4">
        <Link href="/super-admin/workspaces">
          <Button variant="ghost" size="icon">
            <ArrowLeft className="h-4 w-4" />
          </Button>
        </Link>
        <div>
          <h1 className="text-2xl font-bold">{workspace.name}</h1>
          <p className="text-muted-foreground">Configuracion del workspace</p>
        </div>
      </div>

      <div className="grid gap-6 md:grid-cols-2">
        <Card>
          <CardHeader>
            <CardTitle className="text-base">Miembros</CardTitle>
            <CardDescription>Usuarios en este workspace</CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-2">
              {workspace.workspace_members?.map((member: any) => (
                <div key={member.user_id} className="flex items-center justify-between py-2 border-b last:border-0">
                  <div>
                    <p className="text-sm font-medium">
                      {member.profiles?.full_name || member.profiles?.email}
                    </p>
                    {member.profiles?.full_name && (
                      <p className="text-xs text-muted-foreground">
                        {member.profiles?.email}
                      </p>
                    )}
                  </div>
                  <span className="text-xs bg-muted px-2 py-1 rounded capitalize">
                    {member.role}
                  </span>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="text-base">Limites y Configuracion</CardTitle>
            <CardDescription>Configuraciones especiales para este workspace</CardDescription>
          </CardHeader>
          <CardContent>
            <WorkspaceLimitsForm workspaceId={id} initialLimits={limits} />
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
```

**Create src/app/super-admin/workspaces/[id]/components/workspace-limits-form.tsx:**

```typescript
'use client'

import { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Switch } from '@/components/ui/switch'
import { Checkbox } from '@/components/ui/checkbox'
import { updateWorkspaceLimits } from '@/app/actions/super-admin'
import { WorkspaceLimits, TemplateCategory } from '@/lib/whatsapp/types'
import { toast } from 'sonner'
import { Loader2 } from 'lucide-react'

interface WorkspaceLimitsFormProps {
  workspaceId: string
  initialLimits: WorkspaceLimits | null
}

const CATEGORIES: { value: TemplateCategory; label: string }[] = [
  { value: 'MARKETING', label: 'Marketing' },
  { value: 'UTILITY', label: 'Utilidad' },
  { value: 'AUTHENTICATION', label: 'Autenticacion' }
]

export function WorkspaceLimitsForm({ workspaceId, initialLimits }: WorkspaceLimitsFormProps) {
  const [loading, setLoading] = useState(false)

  const [allowedCategories, setAllowedCategories] = useState<TemplateCategory[]>(
    initialLimits?.allowed_categories || ['MARKETING', 'UTILITY', 'AUTHENTICATION']
  )
  const [quickRepliesWithVariables, setQuickRepliesWithVariables] = useState(
    initialLimits?.quick_replies_with_variables || false
  )
  const [quickRepliesWithCategories, setQuickRepliesWithCategories] = useState(
    initialLimits?.quick_replies_with_categories || false
  )
  const [monthlyLimit, setMonthlyLimit] = useState<string>(
    initialLimits?.monthly_spend_limit_usd?.toString() || ''
  )
  const [alertThreshold, setAlertThreshold] = useState<number>(
    initialLimits?.alert_threshold_percent || 80
  )

  const handleCategoryToggle = (category: TemplateCategory, checked: boolean) => {
    if (checked) {
      setAllowedCategories([...allowedCategories, category])
    } else {
      setAllowedCategories(allowedCategories.filter(c => c !== category))
    }
  }

  const handleSave = async () => {
    setLoading(true)
    try {
      await updateWorkspaceLimits(workspaceId, {
        allowed_categories: allowedCategories,
        quick_replies_with_variables: quickRepliesWithVariables,
        quick_replies_with_categories: quickRepliesWithCategories,
        monthly_spend_limit_usd: monthlyLimit ? parseFloat(monthlyLimit) : null,
        alert_threshold_percent: alertThreshold
      })
      toast.success('Configuracion guardada')
    } catch (error) {
      toast.error('Error al guardar')
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="space-y-6">
      {/* Template Categories */}
      <div className="space-y-3">
        <Label>Categorias de Templates Permitidas</Label>
        <div className="space-y-2">
          {CATEGORIES.map((cat) => (
            <div key={cat.value} className="flex items-center gap-2">
              <Checkbox
                id={cat.value}
                checked={allowedCategories.includes(cat.value)}
                onCheckedChange={(checked) => handleCategoryToggle(cat.value, !!checked)}
              />
              <label htmlFor={cat.value} className="text-sm">
                {cat.label}
              </label>
            </div>
          ))}
        </div>
      </div>

      {/* Quick Replies Features */}
      <div className="space-y-3">
        <Label>Funciones de Respuestas Rapidas</Label>
        <div className="space-y-3">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm">Variables dinamicas</p>
              <p className="text-xs text-muted-foreground">
                Permitir variables como {'{nombre}'} en quick replies
              </p>
            </div>
            <Switch
              checked={quickRepliesWithVariables}
              onCheckedChange={setQuickRepliesWithVariables}
            />
          </div>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm">Categorias</p>
              <p className="text-xs text-muted-foreground">
                Organizar quick replies en categorias
              </p>
            </div>
            <Switch
              checked={quickRepliesWithCategories}
              onCheckedChange={setQuickRepliesWithCategories}
            />
          </div>
        </div>
      </div>

      {/* Spending Limits */}
      <div className="space-y-3">
        <Label>Limites de Gasto</Label>
        <div className="grid gap-3">
          <div className="space-y-2">
            <label className="text-sm">Limite mensual (USD)</label>
            <Input
              type="number"
              step="0.01"
              min="0"
              placeholder="Sin limite"
              value={monthlyLimit}
              onChange={(e) => setMonthlyLimit(e.target.value)}
            />
            <p className="text-xs text-muted-foreground">
              Dejar vacio para sin limite
            </p>
          </div>
          <div className="space-y-2">
            <label className="text-sm">Alerta al {alertThreshold}% del limite</label>
            <Input
              type="number"
              min="1"
              max="100"
              value={alertThreshold}
              onChange={(e) => setAlertThreshold(parseInt(e.target.value) || 80)}
            />
          </div>
        </div>
      </div>

      <Button onClick={handleSave} disabled={loading} className="w-full">
        {loading && <Loader2 className="h-4 w-4 mr-2 animate-spin" />}
        Guardar Configuracion
      </Button>
    </div>
  )
}
```

Checkbox component should be available from shadcn/ui. If not, add it.
  </action>
  <verify>Run `pnpm tsc --noEmit` to verify components compile.</verify>
  <done>Workspace list shows all workspaces with member count. Detail page shows members and limits form. Limits form allows configuring template categories, quick reply features, and spending limits.</done>
</task>

<task type="auto">
  <name>Task 3: Consolidated Cost Dashboard</name>
  <files>src/app/super-admin/costos/page.tsx</files>
  <action>
**Create src/app/super-admin/costos/page.tsx:**

```typescript
'use client'

import { useState, useEffect } from 'react'
import { getAllWorkspacesUsage } from '@/app/actions/usage'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Progress } from '@/components/ui/progress'
import { Loader2, Building2, AlertTriangle } from 'lucide-react'
import { cn } from '@/lib/utils'

type Period = 'today' | '7days' | '30days' | 'month'

interface WorkspaceUsage {
  workspaceId: string
  workspaceName: string
  totalMessages: number
  totalCost: number
  limit: number | null
  usagePercent: number | null
}

export default function SuperAdminCostosPage() {
  const [period, setPeriod] = useState<Period>('month')
  const [loading, setLoading] = useState(true)
  const [workspaces, setWorkspaces] = useState<WorkspaceUsage[]>([])

  useEffect(() => {
    loadData()
  }, [period])

  async function loadData() {
    setLoading(true)
    try {
      const data = await getAllWorkspacesUsage(period)
      setWorkspaces(data)
    } catch (error) {
      console.error('Failed to load usage:', error)
    } finally {
      setLoading(false)
    }
  }

  const totalCost = workspaces.reduce((sum, ws) => sum + ws.totalCost, 0)
  const totalMessages = workspaces.reduce((sum, ws) => sum + ws.totalMessages, 0)
  const workspacesNearLimit = workspaces.filter(ws => ws.usagePercent && ws.usagePercent >= 80)

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Costos por Workspace</h1>
          <p className="text-muted-foreground">
            Vision consolidada de uso y costos
          </p>
        </div>
        <div className="flex gap-1 p-1 bg-muted rounded-lg">
          {(['today', '7days', '30days', 'month'] as Period[]).map((p) => (
            <Button
              key={p}
              variant="ghost"
              size="sm"
              onClick={() => setPeriod(p)}
              className={cn(
                'rounded-md',
                period === p && 'bg-background shadow-sm'
              )}
            >
              {p === 'today' ? 'Hoy' :
               p === '7days' ? '7 dias' :
               p === '30days' ? '30 dias' : 'Mes'}
            </Button>
          ))}
        </div>
      </div>

      {/* Summary Cards */}
      <div className="grid gap-4 md:grid-cols-3">
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium">Total Mensajes</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{totalMessages.toLocaleString()}</div>
          </CardContent>
        </Card>
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium">Costo Total</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">${totalCost.toFixed(2)}</div>
          </CardContent>
        </Card>
        <Card className={workspacesNearLimit.length > 0 ? 'border-orange-200' : ''}>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium flex items-center gap-2">
              {workspacesNearLimit.length > 0 && (
                <AlertTriangle className="h-4 w-4 text-orange-500" />
              )}
              Workspaces cerca del limite
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{workspacesNearLimit.length}</div>
          </CardContent>
        </Card>
      </div>

      {/* Workspace Table */}
      <Card>
        <CardHeader>
          <CardTitle className="text-base">Desglose por Workspace</CardTitle>
        </CardHeader>
        <CardContent>
          {loading ? (
            <div className="flex items-center justify-center py-8">
              <Loader2 className="h-6 w-6 animate-spin" />
            </div>
          ) : workspaces.length === 0 ? (
            <div className="text-center py-8 text-muted-foreground">
              No hay datos de uso en este periodo
            </div>
          ) : (
            <div className="space-y-4">
              {workspaces.map((ws) => (
                <div key={ws.workspaceId} className="border rounded-lg p-4">
                  <div className="flex items-center justify-between mb-2">
                    <div className="flex items-center gap-2">
                      <Building2 className="h-4 w-4 text-muted-foreground" />
                      <span className="font-medium">{ws.workspaceName}</span>
                    </div>
                    <div className="text-right">
                      <p className="font-medium">${ws.totalCost.toFixed(4)}</p>
                      <p className="text-sm text-muted-foreground">
                        {ws.totalMessages.toLocaleString()} mensajes
                      </p>
                    </div>
                  </div>

                  {ws.limit && (
                    <div className="space-y-1">
                      <div className="flex items-center justify-between text-sm">
                        <span className="text-muted-foreground">
                          Limite: ${ws.limit.toFixed(2)}
                        </span>
                        <span className={cn(
                          ws.usagePercent && ws.usagePercent >= 100 ? 'text-red-600' :
                          ws.usagePercent && ws.usagePercent >= 80 ? 'text-orange-600' :
                          'text-muted-foreground'
                        )}>
                          {ws.usagePercent?.toFixed(0)}%
                        </span>
                      </div>
                      <Progress
                        value={Math.min(ws.usagePercent || 0, 100)}
                        className={cn(
                          'h-2',
                          ws.usagePercent && ws.usagePercent >= 100 ? '[&>div]:bg-red-500' :
                          ws.usagePercent && ws.usagePercent >= 80 ? '[&>div]:bg-orange-500' : ''
                        )}
                      />
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  )
}
```

Progress component should be available from shadcn/ui. If not, add it.
  </action>
  <verify>Run `pnpm tsc --noEmit` to verify page compiles. Check that Progress component is available.</verify>
  <done>Consolidated cost dashboard shows total messages and costs across all workspaces. Highlights workspaces near spending limit. Shows progress bars for workspaces with limits configured.</done>
</task>

</tasks>

<verification>
1. Super admin layout blocks non-owner users
2. Overview shows platform totals
3. Workspace list shows all workspaces
4. Workspace detail shows members and limits form
5. Limits form saves to workspace_limits table
6. Consolidated costs shows all workspaces usage
7. Near-limit warnings displayed correctly
</verification>

<success_criteria>
- Only MORFX_OWNER_USER_ID can access /super-admin/*
- Workspace limits can be configured
- Consolidated dashboard shows all workspaces
- Spending limits and alerts visible
- All pages compile without errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-whatsapp-extended/08-09-SUMMARY.md`
</output>
